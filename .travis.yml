sudo: false
language: c
os:
  - osx
  - linux
compiler:
  - clang
  - gcc
addons:
  apt:
    packages:
      - gfortran
#matrix:
#  allow_failures:
#    - env: CONDUIT=mpi-pr
#           MPI_IMPL=openmpi
env:
  - CONDUIT="mpi-mt"
    MPI_IMPL=mpich
  - CONDUIT="mpi-mt"
    MPI_IMPL=openmpi
  - CONDUIT="mpi-pt"
    MPI_IMPL=mpich
  - CONDUIT="mpi-pt"
    MPI_IMPL=openmpi
  - CONDUIT="mpi-pr"
    MPI_IMPL=mpich
  - CONDUIT="mpi-pr"
    MPI_IMPL=openmpi
  - CONDUIT="mpi-ts"
    MPI_IMPL=mpich
  - CONDUIT="mpi-ts"
    MPI_IMPL=openmpi
  - CONDUIT="mpi3"
    MPI_IMPL=mpich
  - CONDUIT="mpi3"
    MPI_IMPL=openmpi
  - CONDUIT="mpi-spawn"
    MPI_IMPL=mpich
  - CONDUIT="mpi-spawn"
    MPI_IMPL=openmpi
  - CONDUIT="ofi"
    MPI_IMPL=mpich
  - CONDUIT="ofi"
    MPI_IMPL=openmpi
  - CONDUIT="armci"
    MPI_IMPL=mpich
  - CONDUIT="armci"
    MPI_IMPL=openmpi
before_install:
  - export TRAVIS_ROOT=$HOME/travis
  - mkdir $TRAVIS_ROOT
  - sh ./travis/install-autotools.sh $TRAVIS_ROOT
install:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew update; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install gcc | brew upgrade gcc | true; fi
  - sh ./travis/install-mpi.sh $TRAVIS_ROOT $MPI_IMPL
  - if [[ "$CONDUIT" == "ofi" ]]; then sh ./travis/install-libfabric.sh $TRAVIS_ROOT; fi
  - if [[ "$CONDUIT" == "armci" ]]; then sh ./travis/install-armci-mpi.sh $TRAVIS_ROOT $MPI_IMPL; fi
script:
  - sh ./travis/build-run.sh $TRAVIS_ROOT $CONDUIT $MPI_IMPL
after_failure:
  - cat ./config.log
  - cat ./test-suite.log
  - find . -name "*.log" -exec head -n 100 {} ";"
